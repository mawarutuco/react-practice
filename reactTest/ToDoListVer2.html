<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <!-- React -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>

    <!-- JSX -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- react-bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
  </head>
  <style>
    .done {
      text-decoration: line-through;
    }
  </style>
  <body>
    <div id="app"></div>

    <script type="text/babel">

      function ToDoList() {
        //資料
        let data = {
          id: 2,
          list: [
            { id: 0, item: "龍貓", done: false },
            { id: 1, item: "千尋", done: true },
          ],
        };

        //設useState
        const [onlyId, setId] = React.useState(data.list.length);
        const [list, setList] = React.useState(data.list);

        const Title = () => {
          const [title, setTitle] = React.useState("ToDoList");
          return <h1>{title}</h1>;
        };

        const Edit = () => {
          
        const [inputItem, setInputItem] = React.useState("");

          //input成雙向資料流
          const inputItemChange = (e) => {
            setInputItem(e.target.value);
          };

          //新增待辦事項
          const addItem = () => {
            // if (String(inputItem).trim().length == 0) {
            //   alert("未輸入待辦事項");
            //   return;
            // }

            const pushItem = (prev) => [
              { id: onlyId, item: inputItem, done: false },
              ...prev,
            ];

            setId(onlyId + 1);
            setInputItem("");
            setList(pushItem);
          };

          const inputRef = React.useRef(null);
          // React.useEffect(() => {
          //   inputRef.current.focus();
          // }, [setInputItem]);

          const enterToAddItem = (ev) => {
            if (ev.keyCode == 13) addItem();
          };

          return (
            <div>
              <input
                type="text"
                placeHolder="待辦事項"
                onChange={inputItemChange}
                value={inputItem}
                onKeyUp={enterToAddItem}
                ref={inputRef}
              />
              <button onClick={() => addItem()}>新增</button>
            </div>
          );
        };

        const List = () => {
          //刪除已完成todo
          const deleteAllDoneItem = () => {
            const nowStateList = list.filter(
              (toDoItem) => toDoItem.done === false
            );
            setList(nowStateList);
          };

          return (
            <div>
              <h3>to do</h3>
              <ul>
                {list.map((el) => {
                  if (!el.done) return <Item el={el} />;
                })}
              </ul>
              <h3>done</h3>
              <button onClick={deleteAllDoneItem}>刪除已完成</button>
              <ul>
                {list.map((el) => {
                  if (el.done) return <Item el={el} />;
                })}
              </ul>
            </div>
          );
        };

        const Item = ({ el }) => {
          //打勾完成事項
          const completeHandler = (id) => {
            const nowStateList = list.map((toDoItem) => {
              if (toDoItem.id === id) toDoItem.done = !toDoItem.done;
              return toDoItem;
            });
            setList(nowStateList);

            //   let doneList = [];
            //   let unDoneList = [];
            //   list.map((toDoItem) => {
            //     if (toDoItem.id === id) toDoItem.done = !toDoItem.done;

            //     if (toDoItem.done) doneList.push(toDoItem);
            //     else unDoneList.push(toDoItem);
            //   });
            //   setList([...unDoneList, ...doneList]);
          };

          const modifyToDoItem = (id) => {
            const nowStateList = list.map((toDoItem) => {
              if (toDoItem.id === id) toDoItem.item = prompt("編輯");
              return toDoItem;
            });
            setList(nowStateList);
          };

          //刪除todo
          const deleteToDoItem = (id) => {
            const nowStateList = list.filter((toDoItem) => toDoItem.id !== id);
            setList(nowStateList);
          };

          const { id, done, item } = el;

          return (
            <li key={id}>
              <input
                type="checkbox"
                checked={done}
                onChange={() => completeHandler(id)}
              />
              <span className={done ? "done" : ""}>{item}</span>
              <button
                style={{ display: done ? "none" : "" }}
                onClick={() => modifyToDoItem(id)}
              >
                修改
              </button>
              <button onClick={() => deleteToDoItem(id)}>刪除</button>
              <p></p>

              {/*<input
                value={item}
                className={done ? "done" : ""}
                disabled={done ? "done" : ""}
                // onClick={() => editToDoItem(el)}
                // onChange={() => toDoItemChange()}
              />*/}
              <hr />
            </li>
          );
        };

        return (
          <div>
            <Title />
            <Edit />
            <List />
          </div>
        );
      }

      const app = ReactDOM.createRoot(document.getElementById("app"));
      app.render(
        <div>
          <ToDoList />
        </div>
      );
    </script>
  </body>
</html>
